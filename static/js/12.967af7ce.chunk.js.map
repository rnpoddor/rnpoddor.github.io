{"version":3,"sources":["openjscad/exec_js_dxf.js"],"names":["exec_dxf","scheme","Drawing","d","contours","bounds","ox","glasses","selected_glasses","h","height","y","name","prod_name","replace","substr","indexOf","export_path","src","path","clone","prev","flatten","curves","forEach","index","point1","point2","length","getDistance","drawLine","x","export_contour","layer","addLayer","cnstr","ACI","LAYER","setActiveLayer","profiles","profile","elm","pad","outputData","Blob","toDxfString","type","$p","wsql","alasql","utils","saveAs"],"mappings":";;;;;;;AAAA;AAAA;;;GAKO,QAASA,SAAT,CAAmBC,MAAnB,CAA2BC,OAA3B,CAAoC,CAEzC,GAAIC,GAAI,GAAID,QAAJ,EAAR,CAFyC,GAIlCE,SAJkC,CAIVH,MAJU,CAIlCG,QAJkC,CAIxBC,MAJwB,CAIVJ,MAJU,CAIxBI,MAJwB,CAIhBC,EAJgB,CAIVL,MAJU,CAIhBK,EAJgB,CAKzC,GAAMC,SAAUN,OAAOO,gBAAP,EAAhB,CACA,GAAMC,GAAIJ,OAAOK,MAAP,CAAgBL,OAAOM,CAAjC,CAEA;AACA,GAAIC,MAAON,GAAGO,SAAH,CAAa,IAAb,EAAmBC,OAAnB,CAA2B,IAA3B,CAAgC,GAAhC,CAAX,CACAF,KAAOA,KAAKG,MAAL,CAAY,CAAZ,CAAeH,KAAKI,OAAL,CAAa,GAAb,CAAf,CAAP,CAEA,QAASC,YAAT,CAAqBC,GAArB,CAA0B,CACxB,GAAMC,MAAOD,IAAIC,IAAJ,CAASC,KAAT,CAAe,KAAf,CAAb,CACA,GAAIC,YAAJ,CACAF,KAAKG,OAAL,CAAa,GAAb,EACAH,KAAKI,MAAL,CAAYC,OAAZ,CAAoB,cAAmBC,KAAnB,CAA6B,IAA3BC,OAA2B,MAA3BA,MAA2B,CAAnBC,MAAmB,MAAnBA,MAAmB,CAC/C,GAAG,CAACN,IAAJ,CAAS,CACPA,KAAOK,MAAP,CACD,CACD,GAAGD,OAASN,KAAKI,MAAL,CAAYK,MAAZ,CAAqB,CAAjC,CAAmC,CACjCD,OAASR,KAAKI,MAAL,CAAY,CAAZ,EAAeG,MAAxB,CACD,CAFD,IAGK,IAAGL,KAAKQ,WAAL,CAAiBF,MAAjB,EAA2B,CAA9B,CAAgC,CACjC,OACH,CACDxB,EAAE2B,QAAF,CAAWT,KAAKU,CAAhB,CAAmBtB,EAAIY,KAAKV,CAA5B,CAA+BgB,OAAOI,CAAtC,CAAyCtB,EAAIkB,OAAOhB,CAApD,EACAU,KAAOM,MAAP,CACD,CAZD,EAaD,CAED,QAASK,eAAT,CAAwBC,KAAxB,CAA+B,CAC7B9B,EAAE+B,QAAF,MAAgBD,MAAME,KAAtB,CAA+BjC,QAAQkC,GAAR,CAAYC,KAA3C,CAAkD,YAAlD,EACAlC,EAAEmC,cAAF,MAAsBL,MAAME,KAA5B,EAEA;AACA;AACA;AAN6B,gGAQ7B,kBAAqBF,MAAMM,QAA3B,oHAAqC,IAA3BC,QAA2B,aACnCvB,YAAYuB,OAAZ,EACD,CAV4B,+LAW9B,CAED,GAAGjC,QAAQqB,MAAX,CAAkB,CAChBX,YAAYV,QAAQ,CAAR,CAAZ,EACAK,MAAQ,IAAML,QAAQ,CAAR,EAAWkC,GAAX,CAAeC,GAAf,CAAmB,CAAnB,CAAd,CACD,CAHD,IAII,CACFtC,SAASoB,OAAT,CAAiBQ,cAAjB,EACD,CAGD,GAAMW,YAAa,GAAIC,KAAJ,CAAS,CAACzC,EAAE0C,WAAF,GAAgB/B,OAAhB,CAAwB,KAAxB,CAA+B,MAA/B,CAAD,CAAT,CAAmD,CAACgC,KAAO,iBAAR,CAAnD,CAAnB,CACAC,GAAGC,IAAH,CAAQC,MAAR,CAAeC,KAAf,CAAqBC,MAArB,CAA4BR,UAA5B,CAA2C/B,IAA3C,SAED,C","file":"static/js/12.967af7ce.chunk.js","sourcesContent":["/**\r\n * ### Осуществляет экспорт в dxf\r\n * Created by Evgeniy Malyarov on 24.11.2017.\r\n */\r\n\r\nexport function exec_dxf (scheme, Drawing) {\r\n\r\n  let d = new Drawing();\r\n\r\n  const {contours, bounds, ox} = scheme;\r\n  const glasses = scheme.selected_glasses();\r\n  const h = bounds.height + bounds.y;\r\n\r\n  // имя будущего файла\r\n  let name = ox.prod_name(true).replace(/\\//,'-');\r\n  name = name.substr(0, name.indexOf('/'));\r\n\r\n  function export_path(src) {\r\n    const path = src.path.clone(false);\r\n    let prev;\r\n    path.flatten(0.5);\r\n    path.curves.forEach(({point1, point2}, index) => {\r\n      if(!prev){\r\n        prev = point1;\r\n      }\r\n      if(index == path.curves.length - 1){\r\n        point2 = path.curves[0].point1;\r\n      }\r\n      else if(prev.getDistance(point2) < 2){\r\n          return;\r\n      }\r\n      d.drawLine(prev.x, h - prev.y, point2.x, h - point2.y);\r\n      prev = point2;\r\n    });\r\n  }\r\n\r\n  function export_contour(layer) {\r\n    d.addLayer(`l_${layer.cnstr}`, Drawing.ACI.LAYER, 'CONTINUOUS');\r\n    d.setActiveLayer(`l_${layer.cnstr}`);\r\n\r\n    // for(const glass of layer.glasses(false, true)) {\r\n    //   export_path(glass);\r\n    // }\r\n\r\n    for(const profile of layer.profiles) {\r\n      export_path(profile);\r\n    }\r\n  }\r\n\r\n  if(glasses.length){\r\n    export_path(glasses[0]);\r\n    name += '-' + glasses[0].elm.pad(2);\r\n  }\r\n  else{\r\n    contours.forEach(export_contour);\r\n  }\r\n\r\n\r\n  const outputData = new Blob([d.toDxfString().replace(/\\n/g, '\\r\\n')], {type : 'application/dxf'});\r\n  $p.wsql.alasql.utils.saveAs(outputData, `${name}.dxf`);\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/openjscad/exec_js_dxf.js"],"sourceRoot":""}